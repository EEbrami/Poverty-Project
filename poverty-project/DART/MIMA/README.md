# Moving Averages (MIMA) for Median Income Data

This directory contains 5-year moving average (MA(5)) computations for equivalised disposable household income medians from the Luxembourg Income Study (LIS) Data Access Research Tool (DART).

## Data Source

- **Input**: `xlsxConverted/csvFiles/dart-med-pop_decomp-dhi.csv`
- **Countries**: Canada, Germany, Luxembourg, United Kingdom, United States
- **Time Period**: 1985-2021 (inclusive)

## Methodology

The data is processed with linear interpolation for gaps of 1-2 years (excluding endpoints and gaps > 2 years). Three MA(5) variants are computed:

### 1. Centered 5-Year Moving Average (`centered_ma5_1985-2021.csv`)

- **Window**: t-2 to t+2 (symmetric, 5 years)
- **Calculation**: Simple arithmetic mean of median incomes
- **Requirement**: At least 3 values in window
- **Rationale**: Balanced smoothing, minimizing lag bias for long-run trend analysis

### 2. Trailing 5-Year Moving Average (`trailing_ma5_1985-2021.csv`)

- **Window**: t-4 to t (backward-looking, 5 years)
- **Calculation**: Simple arithmetic mean of median incomes
- **Requirement**: At least 3 values in window
- **Rationale**: Historical accumulation, suitable for volatility attenuation without incorporating future data

### 3. Weighted 5-Year Moving Average (`weighted_ma5_1985-2021.csv`)

- **Window**: t-2 to t+2 (symmetric, 5 years)
- **Weights**: [1, 2, 3, 2, 1] (triangular, normalized by sum = 9)
- **Calculation**: Weighted sum divided by sum of weights
- **Requirement**: At least 3 weighted values in window
- **Rationale**: Nuanced smoothing with emphasis on central year, reducing endpoint bias

## File Format

Each CSV file contains:
- **Header row**: `year,Canada,Germany,Luxembourg,United Kingdom,United States`
- **Data rows**: Years 1985-2021 with computed MA values (2 decimal places)
- **Metadata footer**: Comments (lines starting with `#`) documenting:
  - Method description
  - Year range and countries
  - Interpolations performed
  - NaN values and reasons (insufficient data)

## Generation

The moving averages are generated by the script:
```bash
python3 scripts/compute_moving_averages.py
```

This script is idempotent and logs progress to stdout for debugging.

## Notes

- Empty cells in early years of trailing MA indicate insufficient historical data (< 3 years)
- Boundary years in centered MA use partial windows when available
- All computations use floating-point precision rounded to 2 decimal places
- The original data is top- and bottom-coded per LIS standards and equivalised using the square root of household size

## References

- LIS Data Access Research Tool (DART): https://www.lisdatacenter.org/data-access/dart/
- Methodological notes: See `DART/Methodological_Remarks.md` in repository root
